# Classifying pointer based pagefaults

## Setup
## Linux kernel setup
Setup the linux kernel from [here](https://github.com/shauryapatel1995/swap-trace). Follow instructions and confirm that the perf record probe can be installed. 

## Building the analyzer 
Build the analyzer after cloning the repository. 

``` g++ -std=c++17 vmem_timeline_stream.cpp -o vmem_timeline_stream -lpthread ```

## Setup PIN
Setup pin as a subfolder inside the pointer analysis folder. Follow build instructions from [here](https://software.intel.com/sites/landingpage/pintool/docs/98484/Pin/html/index.html).
Make sure you can build and setup the [pinatrace](https://software.intel.com/sites/landingpage/pintool/docs/98484/Pin/html/index.html#MAddressTrace) example located in Manual Examples for PIN.

Copy the updated pinatrace tool to the Manual Examples folder from the repository to the PIN sub directory. 

## Running the analyzer 
The analyzer takes two file descriptors as input, currently we use two data streams generated by PIN and by Linux perf as inputs. We use [process substitution](https://tldp.org/LDP/abs/html/process-sub.html) to feed the data inputs.

### Analyzer Command 
The order of pagefault command and pin command is important. Pagefaults should always have the --ns option for the merging algorithm to work.

``` ../vmem_timeline_stream <(pagefault command) <(pin command) ```

### The pagefault command 
``` sudo ./perf record -e probe:do_swap_page_L46 --clockid CLOCK_MONOTONIC -aR | sudo ./perf script --ns```

### The PIN commands 
We use cgroups to control the memory percentage available to an application. Use the same percentage you would as without PIN tool.
Pin commands look different for different applications. For microbenchmarks use the following command. 

``` sudo cgexec -g memory:trial ./pin -t source/tools/ManualExamples/obj-intel64/pinatrace.so -- ./benchmark_to_run ```

Setup parsec from [here](url). For parsec we use the -s option of the benchmark to append a command to run before the benchmark. 

``` parsecmgmt -a run -p parsec.canneal -i simlarge -s "sudo cgexec -g memory:trial ./pin -t source/tools/ManualExamples/obj-intel64/pinatrace.so --"```

Setup xhpcg from [here](https://hpcg-benchmark.org/software/browse.html%3Fstart=0&per=5.html). Follow [these instructions](https://ireneli.eu/2016/02/15/installation/) to setup MPI first.
Run xhpcg with PIN

``` ```
